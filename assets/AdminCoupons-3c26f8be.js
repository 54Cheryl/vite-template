import{P as x,L as $}from"./PaginationView-d6d9f6e2.js";import{m as P,D}from"./DelModal-dcd290cc.js";import{_ as k,r as c,o as i,c as a,a as e,b as l,w as V,n as f,bu as L,bg as N,d as w,t as b,F as y,i as T}from"./index-3e315e58.js";import{S as h,T as M}from"./swalToast-e65c17dd.js";const U={props:{coupon:{},isNew:{}},data(){return{tempCoupon:{},modal:"",due_date:""}},watch:{coupon(){if(this.tempCoupon=this.coupon,this.tempCoupon.due_date){const n=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T",1)[0];this.due_date=n}},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},mixins:[P],emits:["update-coupon"]},B={class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},E={class:"modal-dialog"},A={class:"modal-content"},F={class:"modal-header bg-dark text-white"},S={class:"modal-title",id:"exampleModalLabel"},q={key:0},I={key:1},R=e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),O={class:"modal-body"},H={class:"col"},j=e("label",{class:"form-label mt-2",for:"title"},"優惠券名稱",-1),z={class:"col"},G=e("label",{class:"form-label mt-2",for:"coupon_code"},"優惠代碼",-1),J={class:"col"},K=e("label",{class:"form-label mt-2",for:"due_date"},"到期日",-1),Q={class:"col"},W=e("label",{class:"form-label mt-2",for:"percent"},"折扣百分比",-1),X={class:"col my-3"},Y=e("label",{class:"form-label ms-2",for:"is_enabled"},"是否啟用",-1),Z={class:"modal-footer"},ee=e("button",{type:"button",class:"btn btn-outline-n500","data-bs-dismiss":"modal"},"取消",-1);function oe(n,o,m,_,t,d){const p=c("VField"),u=c("ErrorMessage"),v=c("VForm");return i(),a("div",B,[e("div",E,[e("div",A,[e("div",F,[e("h5",S,[m.isNew?(i(),a("span",q,"新增優惠券")):(i(),a("span",I,"編輯優惠券"))]),R]),e("div",O,[l(v,null,{default:V(({errors:r})=>[e("div",H,[j,l(p,{id:"title",name:"名稱",type:"text",class:f(["form-control",{"is-invalid":r.名稱}]),placeholder:"請輸入名稱",rules:"required",modelValue:t.tempCoupon.title,"onUpdate:modelValue":o[0]||(o[0]=s=>t.tempCoupon.title=s)},null,8,["class","modelValue"]),l(u,{name:"名稱",class:"invalid-feedback"})]),e("div",z,[G,l(p,{id:"coupon_code",name:"代碼",type:"text",class:f(["form-control",{"is-invalid":r.代碼}]),placeholder:"請輸入代碼",rules:"required",modelValue:t.tempCoupon.code,"onUpdate:modelValue":o[1]||(o[1]=s=>t.tempCoupon.code=s)},null,8,["class","modelValue"]),l(u,{name:"代碼",class:"invalid-feedback"})]),e("div",J,[K,l(p,{id:"due_date",name:"到期日",type:"date",class:f(["form-control",{"is-invalid":r.到期日}]),rules:"required",modelValue:t.due_date,"onUpdate:modelValue":o[2]||(o[2]=s=>t.due_date=s),min:t.due_date},null,8,["class","modelValue","min"]),l(u,{name:"到期日",class:"invalid-feedback"})]),e("div",Q,[W,l(p,{id:"percent",name:"百分比",type:"number",min:"0",max:"100",class:f(["form-control",{"is-invalid":r.百分比}]),placeholder:"請輸入折扣百分比",rules:"required",modelValue:t.tempCoupon.percent,"onUpdate:modelValue":o[3]||(o[3]=s=>t.tempCoupon.percent=s),modelModifiers:{number:!0}},null,8,["class","modelValue"]),l(u,{name:"百分比",class:"invalid-feedback"})]),e("div",X,[L(e("input",{id:"is_enabled",name:"是否啟用",type:"checkbox",class:"form-check-input","onUpdate:modelValue":o[4]||(o[4]=s=>t.tempCoupon.is_enabled=s),"true-value":1,"false-value":0},null,512),[[N,t.tempCoupon.is_enabled]]),Y])]),_:1})]),e("div",Z,[ee,e("button",{type:"button",class:"btn btn-custom",style:{"padding-left":"1.5rem"},onClick:o[5]||(o[5]=()=>n.$emit("update-coupon"))},"確認")])])])],512)}const te=k(U,[["render",oe]]),{VITE_APP_URL:C,VITE_APP_PATH:g}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_APP_PATH:"cheryl-hexschool",BASE_URL:"/vite-template/",MODE:"production",DEV:!1,PROD:!0},se={props:["token"],data(){return{coupons:[],pagination:{},isNew:!1,tempCoupon:{},isLoading:!1,fullPage:!0}},methods:{getCoupons(n=1){this.isLoading=!0,this.$http.get(`${C}api/${g}/admin/coupons/?page=${n}`).then(o=>{this.isLoading=!1,this.coupons=o.data.coupons,this.pagination=o.data.pagination}).catch(o=>{h.fire({icon:"error",title:o.response.data.message,confirmButtonColor:"#ab7e52"})})},openCoupon(n,o){n==="new"?(this.isNew=!0,this.tempCoupon={due_date:new Date().getTime()/1e3,is_enabled:0},this.$refs.couponModal.showModal()):n==="edit"?(this.isNew=!1,this.tempCoupon={...o},this.$refs.couponModal.showModal()):n==="delete"&&(this.tempCoupon={...o},this.$refs.deleteModal.showModal())},updateCoupon(){const n=Math.floor(new Date/1e3);if(this.tempCoupon.due_date<n)h.fire({icon:"error",title:"輸入錯誤",text:"不可輸入過去日期",confirmButtonColor:"#ab7e52"});else if(this.tempCoupon.percent>100||this.tempCoupon.percent<0)h.fire({icon:"error",title:"輸入錯誤",text:"折扣百分比只能為0~100",confirmButtonColor:"#ab7e52"});else{let o=`${C}api/${g}/admin/coupon`,m="post";this.isNew||(o=`${C}api/${g}/admin/coupon/${this.tempCoupon.id}`,m="put"),this.$http[m](o,{data:this.tempCoupon}).then(_=>{M.fire({icon:"success",title:_.data.message}),this.tempCoupon={},this.$refs.couponModal.hideModal(),this.getCoupons()}).catch(_=>{h.fire({icon:"error",title:_.response.data.message,confirmButtonColor:"#ab7e52"})})}},deleteCoupon(){const n=`${C}api/${g}/admin/coupon/${this.tempCoupon.id}`;this.$http.delete(n).then(o=>{M.fire({icon:"success",title:o.data.message}),this.$refs.deleteModal.hideModal(),this.getCoupons()}).catch(o=>{h.fire({icon:"error",title:o.response.data.message,confirmButtonColor:"#ab7e52"})})}},components:{Pagination:x,DelModal:D,Loading:$,CouponModal:te},mounted(){this.getCoupons()}},ne=e("div",{class:"loadingio-spinner-spin-ekq2gap1645"},[e("div",{class:"ldio-kyayy0fncmo"},[e("div",null,[e("div")]),e("div",null,[e("div")]),e("div",null,[e("div")]),e("div",null,[e("div")]),e("div",null,[e("div")]),e("div",null,[e("div")]),e("div",null,[e("div")]),e("div",null,[e("div")])])],-1),le={class:"container",style:{"margin-top":"7vh"}},ie={class:"pt-5"},ae={class:"d-flex justify-content-between"},de={class:"mb-0 px-2 d-flex align-items-center"},ce={class:"text-end"},pe={class:"table table-hover mt-2"},ue=e("thead",null,[e("tr",null,[e("th",{width:"150"},"優惠券名稱"),e("th",{width:"120"},"折扣百分比"),e("th",{width:"120"},"到期日"),e("th",{width:"120"},"是否啟用"),e("th",{width:"120"},"編輯")])],-1),re={width:"150"},me={width:"120"},_e={width:"120"},he={width:"120"},fe={key:0,class:"text-success"},be={key:1},Ce={width:"120"},ge=["onClick"],ve=["onClick"],we={class:"row"},ye={class:"col"};function Me(n,o,m,_,t,d){const p=c("Loading"),u=c("Pagination"),v=c("CouponModal"),r=c("DelModal");return i(),a(y,null,[l(p,{active:t.isLoading,"onUpdate:active":o[0]||(o[0]=s=>t.isLoading=s),"can-cancel":!0,"is-full-page":t.fullPage},{default:V(()=>[ne]),_:1},8,["active","is-full-page"]),e("div",le,[e("div",ie,[e("div",ae,[e("p",de,[w("本頁有 "),e("span",null,b(t.coupons.length),1),w(" 項產品")]),e("div",ce,[e("button",{type:"button",class:"btn btn-custom text-light",onClick:o[1]||(o[1]=()=>d.openCoupon("new",n.item)),style:{"padding-left":"1.5rem"}},"新增優惠券")])]),e("table",pe,[ue,e("tbody",null,[(i(!0),a(y,null,T(t.coupons,s=>(i(),a("tr",{key:s.id},[e("td",re,b(s.title),1),e("td",me,b(s.percent),1),e("td",_e,b(n.$filters.date(s.due_date)),1),e("td",he,[s.is_enabled?(i(),a("span",fe,"啟用")):(i(),a("span",be,"未啟用"))]),e("td",Ce,[e("button",{type:"button",class:"btn btn-outline-main btn-sm me-2 backendBtn",onClick:()=>d.openCoupon("edit",s)},"編輯",8,ge),e("button",{type:"button",class:"btn btn-outline-accent btn-sm",onClick:()=>d.openCoupon("delete",s),style:{padding:"0.25rem 0.5rem"}},"刪除",8,ve)])]))),128))])]),e("div",we,[e("div",ye,[l(u,{pages:t.pagination,onChangePage:d.getCoupons},null,8,["pages","onChangePage"])]),l(v,{coupon:t.tempCoupon,isNew:t.isNew,ref:"couponModal",onUpdateCoupon:d.updateCoupon},null,8,["coupon","isNew","onUpdateCoupon"]),l(r,{"temp-data":t.tempCoupon,ref:"deleteModal",onDelData:d.deleteCoupon},null,8,["temp-data","onDelData"])])])])],64)}const Pe=k(se,[["render",Me]]);export{Pe as default};
