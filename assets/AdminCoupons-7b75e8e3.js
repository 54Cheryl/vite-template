import{P as k,L as P}from"./PaginationView-007a4ec9.js";import{m as D,D as L}from"./DelModal-c5cadd8f.js";import{_ as v,o as l,c as a,a as t,bt as c,bj as u,bf as T,r,b as h,d as C,t as m,F as g,k as V}from"./index-9522caaf.js";import{S as _,T as w}from"./swalToast-f80a10dc.js";const N={props:{coupon:{},isNew:{}},data(){return{tempCoupon:{},modal:"",due_date:""}},watch:{coupon(){if(this.tempCoupon=this.coupon,this.tempCoupon.due_date){const s=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T",1)[0];this.due_date=s}},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},mixins:[D],emits:["update-coupon"]},U={class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},A={class:"modal-dialog"},E={class:"modal-content"},S={class:"modal-header bg-dark text-white"},B={class:"modal-title",id:"exampleModalLabel"},I={key:0},R={key:1},O=t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),j={class:"modal-body"},F={action:""},H={class:"col"},q=t("label",{class:"form-label mt-2",for:"title"},"優惠券名稱",-1),z={class:"col"},G=t("label",{class:"form-label mt-2",for:"coupon_code"},"優惠代碼",-1),J={class:"col"},K=t("label",{class:"form-label mt-2",for:"due_date"},"到期日",-1),Q={class:"col"},W=t("label",{class:"form-label mt-2",for:"percent"},"折扣百分比",-1),X={class:"col my-3"},Y=t("label",{class:"form-label ms-2",for:"is_enabled"},"是否啟用",-1),Z={class:"modal-footer"},tt=t("button",{type:"button",class:"btn btn-outline-n500","data-bs-dismiss":"modal"},"取消",-1);function et(s,e,p,y,o,d){return l(),a("div",U,[t("div",A,[t("div",E,[t("div",S,[t("h5",B,[p.isNew?(l(),a("span",I,"新增優惠券")):(l(),a("span",R,"編輯優惠券"))]),O]),t("div",j,[t("form",F,[t("div",H,[q,c(t("input",{type:"text",class:"form-control",id:"title",placeholder:"請輸入名稱","onUpdate:modelValue":e[0]||(e[0]=n=>o.tempCoupon.title=n)},null,512),[[u,o.tempCoupon.title]])]),t("div",z,[G,c(t("input",{type:"text",class:"form-control",id:"coupon_code",placeholder:"請輸入代碼","onUpdate:modelValue":e[1]||(e[1]=n=>o.tempCoupon.code=n)},null,512),[[u,o.tempCoupon.code]])]),t("div",J,[K,c(t("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":e[2]||(e[2]=n=>o.due_date=n)},null,512),[[u,o.due_date]])]),t("div",Q,[W,c(t("input",{type:"number",min:"0",max:"100",class:"form-control",id:"percent",placeholder:"請輸入折扣百分比","onUpdate:modelValue":e[3]||(e[3]=n=>o.tempCoupon.percent=n)},null,512),[[u,o.tempCoupon.percent,void 0,{number:!0}]])]),t("div",X,[c(t("input",{type:"checkbox",class:"form-check-input",id:"is_enabled","onUpdate:modelValue":e[4]||(e[4]=n=>o.tempCoupon.is_enabled=n),"true-value":1,"false-value":0},null,512),[[T,o.tempCoupon.is_enabled]]),Y])])]),t("div",Z,[tt,t("button",{type:"button",class:"btn btn-custom",style:{"padding-left":"1.5rem"},onClick:e[5]||(e[5]=()=>s.$emit("update-coupon"))},"確認")])])])],512)}const ot=v(N,[["render",et]]),{VITE_APP_URL:f,VITE_APP_PATH:b}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_APP_PATH:"cheryl-hexschool",BASE_URL:"/vite-template/",MODE:"production",DEV:!1,PROD:!0},st={props:["token"],data(){return{coupons:[],pagination:{},isNew:!1,tempCoupon:{},isLoading:!1,fullPage:!0}},methods:{getCoupons(s=1){this.isLoading=!0,this.$http.get(`${f}api/${b}/admin/coupons/?page=${s}`).then(e=>{this.isLoading=!1,this.coupons=e.data.coupons,this.pagination=e.data.pagination}).catch(e=>{_.fire({icon:"error",title:e.response.data.message})})},openCoupon(s,e){s==="new"?(this.isNew=!0,this.tempCoupon={due_date:new Date().getTime()/1e3},this.$refs.couponModal.showModal()):s==="edit"?(this.isNew=!1,this.tempCoupon={...e},this.$refs.couponModal.showModal()):s==="delete"&&(this.tempCoupon={...e},this.$refs.deleteModal.showModal())},updateCoupon(){if(this.tempCoupon.percent>100||this.tempCoupon.percent<0)_.fire({icon:"error",title:"輸入錯誤",text:"折扣百分比只能為0~100"});else{let s=`${f}api/${b}/admin/coupon`,e="post";this.isNew||(s=`${f}api/${b}/admin/coupon/${this.tempCoupon.id}`,e="put"),this.$http[e](s,{data:this.tempCoupon}).then(p=>{w.fire({icon:"success",title:p.data.message}),this.tempCoupon={},this.$refs.couponModal.hideModal(),this.getCoupons()}).catch(p=>{_.fire({icon:"error",title:p.response.data.message})})}},deleteCoupon(){const s=`${f}api/${b}/admin/coupon/${this.tempCoupon.id}`;this.$http.delete(s).then(e=>{w.fire({icon:"success",title:e.data.message}),this.$refs.deleteModal.hideModal(),this.getCoupons()}).catch(e=>{_.fire({icon:"error",title:e.response.data.message})})}},components:{Pagination:k,DelModal:L,Loading:P,CouponModal:ot},mounted(){this.getCoupons()}},nt={class:"container",style:{"margin-top":"7vh"}},it={class:"pt-5"},lt={class:"d-flex justify-content-between"},at={class:"mb-0 px-2"},dt={class:"text-end"},pt={class:"table table-hover mt-2"},ct=t("thead",null,[t("tr",null,[t("th",{width:"150"},"優惠券名稱"),t("th",{width:"120"},"折扣百分比"),t("th",{width:"120"},"到期日"),t("th",{width:"120"},"是否啟用"),t("th",{width:"120"},"編輯")])],-1),ut={width:"150"},rt={width:"120"},ht={width:"120"},mt={width:"120"},_t={key:0,class:"text-success"},ft={key:1},bt={width:"120"},Ct=["onClick"],gt=["onClick"],wt={class:"row"},vt={class:"col"};function yt(s,e,p,y,o,d){const n=r("Loading"),M=r("Pagination"),$=r("CouponModal"),x=r("DelModal");return l(),a(g,null,[h(n,{active:o.isLoading,"onUpdate:active":e[0]||(e[0]=i=>o.isLoading=i),"can-cancel":!0,"is-full-page":o.fullPage},null,8,["active","is-full-page"]),t("div",nt,[t("div",it,[t("div",lt,[t("p",at,[C("本頁有 "),t("span",null,m(o.coupons.length),1),C(" 項產品")]),t("div",dt,[t("button",{type:"button",class:"btn btn-custom text-light",onClick:e[1]||(e[1]=()=>d.openCoupon("new",s.item)),style:{"padding-left":"1.5rem"}},"新增優惠券")])]),t("table",pt,[ct,t("tbody",null,[(l(!0),a(g,null,V(o.coupons,i=>(l(),a("tr",{key:i.id},[t("td",ut,m(i.title),1),t("td",rt,m(i.percent),1),t("td",ht,m(s.$filters.date(i.due_date)),1),t("td",mt,[i.is_enabled?(l(),a("span",_t,"啟用")):(l(),a("span",ft,"未啟用"))]),t("td",bt,[t("button",{type:"button",class:"btn btn-outline-main btn-sm me-2 backendBtn",onClick:()=>d.openCoupon("edit",i)},"編輯",8,Ct),t("button",{type:"button",class:"btn btn-outline-accent btn-sm",onClick:()=>d.openCoupon("delete",i),style:{padding:"0.25rem 0.5rem"}},"刪除",8,gt)])]))),128))])]),t("div",wt,[t("div",vt,[h(M,{pages:o.pagination,onChangePage:d.getCoupons},null,8,["pages","onChangePage"])]),h($,{coupon:o.tempCoupon,isNew:o.isNew,ref:"couponModal",onUpdateCoupon:d.updateCoupon},null,8,["coupon","isNew","onUpdateCoupon"]),h(x,{"temp-data":o.tempCoupon,ref:"deleteModal",onDelData:d.deleteCoupon},null,8,["temp-data","onDelData"])])])])],64)}const Pt=v(st,[["render",yt]]);export{Pt as default};
