import{P as C,L as V}from"./PaginationView-03e11033.js";import{m as E,D as S}from"./DelModal-7a671464.js";import{_ as v,o as l,c as r,a as e,t as d,l as k,bt as M,bf as P,F as f,k as y,r as _,b as h,d as $}from"./index-1ab0d20f.js";import{S as u,T as g}from"./swalToast-f80a10dc.js";const U={props:{order:{}},data(){return{modal:"",tempOrder:{}}},watch:{order(){this.tempOrder=this.order}},mixins:[E],emits:["cancel-order","update-order"]},A={class:"modal fade",id:"orderModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},T={class:"modal-dialog modal-xl"},B={class:"modal-content"},I=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},[e("span",null,"訂單細節")]),e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),N={class:"modal-body"},R={class:"row"},q={class:"col-4"},F=e("h3",null,"用戶資料",-1),H={class:"table"},j={key:0},z=e("th",null,"姓名",-1),G=e("th",null,"Email",-1),J=e("th",null,"電話",-1),K=e("th",null,"地址",-1),Q={key:0},W=e("th",null,"留言",-1),X={class:"col-8"},Y=e("h3",null,"訂單細節",-1),Z={class:"table"},ee=e("th",null,"訂單編號",-1),te=e("th",null,"下單時間",-1),se=e("th",null,"付款時間",-1),oe={key:0},de={key:1},le=e("th",null,"付款狀態",-1),re={class:"form-check form-switch"},ne=["for"],ae={key:0,class:"text-success"},ie={key:1,class:"text-danger"},ce=["id"],pe=e("th",null,"總金額",-1),_e=e("h3",null,"購買品項",-1),he={class:"table"},ue={class:"text-end"},me={class:"modal-footer"};function be(o,t,O,c,s,i){return l(),r("div",A,[e("div",T,[e("div",B,[I,e("div",N,[e("div",R,[e("div",q,[F,e("table",H,[s.tempOrder.user?(l(),r("tbody",j,[e("tr",null,[z,e("td",null,d(s.tempOrder.user.name),1)]),e("tr",null,[G,e("td",null,d(s.tempOrder.user.email),1)]),e("tr",null,[J,e("td",null,d(s.tempOrder.user.tel),1)]),e("tr",null,[K,e("td",null,d(s.tempOrder.user.address),1)]),s.tempOrder.message?(l(),r("tr",Q,[W,e("td",null,d(s.tempOrder.message),1)])):k("",!0)])):k("",!0)])]),e("div",X,[Y,e("table",Z,[e("tbody",null,[e("tr",null,[ee,e("td",null,d(s.tempOrder.id),1)]),e("tr",null,[te,e("td",null,d(o.$filters.date(s.tempOrder.create_at)),1)]),e("tr",null,[se,e("td",null,[s.tempOrder.paid_date?(l(),r("span",oe,d(s.tempOrder.paid_date),1)):(l(),r("span",de,"時間不正確"))])]),e("tr",null,[le,e("td",null,[e("template",re,[e("label",{class:"form-check-label",for:`paidSwitch${s.tempOrder.id}`},[s.tempOrder.is_paid?(l(),r("strong",ae,"已付款")):(l(),r("strong",ie,"未付款"))],8,ne),M(e("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${s.tempOrder.id}`,"onUpdate:modelValue":t[0]||(t[0]=a=>s.tempOrder.is_paid=a)},null,8,ce),[[P,s.tempOrder.is_paid]])])])]),e("tr",null,[pe,e("td",null," $ "+d(o.$filters.currency(s.tempOrder.total)),1)])])]),_e,e("table",he,[e("tbody",null,[(l(!0),r(f,null,y(s.tempOrder.products,a=>(l(),r("tr",{key:a.id},[e("th",null,d(a.product.title),1),e("td",null,d(a.qty)+" / "+d(a.product.unit),1),e("td",ue," $ "+d(o.$filters.currency(a.final_total)),1)]))),128))])])])])]),e("div",me,[e("button",{type:"button",class:"btn btn-outline-n500","data-bs-dismiss":"modal",onClick:t[1]||(t[1]=()=>o.$emit("cancel-order"))},"取消"),e("button",{type:"button",class:"btn btn-custom",style:{"padding-left":"1.5rem"},onClick:t[2]||(t[2]=()=>o.$emit("update-order"))},"確認")])])])],512)}const fe=v(U,[["render",be]]);const{VITE_APP_URL:m,VITE_APP_PATH:b}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_APP_PATH:"cheryl-hexschool",BASE_URL:"/vite-template/",MODE:"production",DEV:!1,PROD:!0},Oe={props:["token"],data(){return{orders:[],pagination:{},tempOrder:{},isLoading:!1,fullPage:!0}},methods:{getOrders(o=1){this.isLoading=!0,this.$http.get(`${m}api/${b}/admin/orders/?page=${o}`).then(t=>{this.isLoading=!1,this.orders=t.data.orders,this.pagination=t.data.pagination}).catch(t=>{u.fire({icon:"error",title:t.response.data.message})})},updatePaid(o){if(o.is_paid){const c=new Date().toLocaleDateString();o.paid_date=c}else o.paid_date="";const t={is_paid:o.is_paid,paid_date:o.paid_date};g.fire({icon:"success",title:"已更新訂單資訊"});const O=`${m}api/${b}/admin/order/${o.id}`;this.$http.put(O,{data:t}).then(c=>{this.getOrders()}).catch(c=>{u.fire({icon:"error",title:c.response.data.message})})},openOrder(o,t){o==="edit"?(this.tempOrder={...t},this.$refs.orderModal.showModal()):o==="delete"&&(this.tempOrder={...t},this.$refs.deleteModal.showModal())},cancelOrder(){this.tempOrder={},this.$refs.OrderModal.hideModal()},updateOrder(){const o=`${m}api/${b}/admin/order/${this.tempOrder.id}`;if(this.tempOrder.is_paid){const t=new Date().toLocaleDateString();this.tempOrder.paid_date=t}else this.tempOrder.paid_date="";this.$http.put(o,{data:this.tempOrder}).then(t=>{this.$refs.orderModal.hideModal(),this.tempOrder={},this.getOrders(),g.fire({icon:"success",title:t.data.message})}).catch(t=>{u.fire({icon:"error",title:t.response.data.message})})},deleteOrder(){const o=`${m}api/${b}/admin/order/${this.tempOrder.id}`;this.$http.delete(o).then(t=>{this.$refs.deleteModal.hideModal(),this.getOrders(),g.fire({icon:"success",title:t.data.message})}).catch(t=>{u.fire({icon:"error",title:t.response.data.message})})}},components:{Pagination:C,DelModal:S,OrderModal:fe,Loading:V},mounted(){this.getOrders()}},ge={class:"container",style:{"margin-top":"7vh"}},ye={class:"pt-5"},ke={class:"mb-0 px-2"},$e={class:"table table-hover mt-2"},ve=e("thead",null,[e("tr",null,[e("th",null,"購買時間"),e("th",null,"Email"),e("th",{class:"backend-use"},"購買品項"),e("th",{class:"backend-use"},"應付金額"),e("th",null,"是否付款"),e("th",{class:"text-center"},"編輯")])],-1),Me={class:"backend-use"},Pe={class:"list-unstyled"},De={class:"col"},we={class:"col"},xe={class:"backend-use"},Le={class:"form-check form-switch"},Ce=["id","onUpdate:modelValue","onChange"],Ve=["for"],Ee={key:0},Se={key:1},Ue={class:"d-flex justify-content-evenly"},Ae=["onClick"],Te=["onClick"],Be={class:"row"},Ie={class:"col"};function Ne(o,t,O,c,s,i){const a=_("Loading"),D=_("Pagination"),w=_("OrderModal"),x=_("DelModal");return l(),r(f,null,[h(a,{active:s.isLoading,"onUpdate:active":t[0]||(t[0]=n=>s.isLoading=n),"can-cancel":!0,"is-full-page":s.fullPage},null,8,["active","is-full-page"]),e("div",ge,[e("div",ye,[e("p",ke,[$("本頁有 "),e("span",null,d(s.orders.length),1),$(" 張訂單")]),e("table",$e,[ve,e("tbody",null,[(l(!0),r(f,null,y(s.orders,n=>(l(),r("tr",{key:n.id},[e("td",null,d(o.$filters.date(n.create_at)),1),e("td",null,d(n.user.email),1),e("td",Me,[e("ul",Pe,[(l(!0),r(f,null,y(n.products,(p,L)=>(l(),r("li",{key:L,class:"row mb-1"},[e("span",De,d(p.product.title),1),e("span",we," 數量 : "+d(p.qty)+" "+d(p.product.unit),1)]))),128))])]),e("td",xe," $ "+d(n.total),1),e("td",null,[e("div",Le,[M(e("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${n.id}`,"onUpdate:modelValue":p=>n.is_paid=p,onChange:p=>i.updatePaid(n)},null,40,Ce),[[P,n.is_paid]]),e("label",{class:"form-check-label",for:`paidSwitch${n.id}`},[n.is_paid?(l(),r("span",Ee,"已付款")):(l(),r("span",Se,"未付款"))],8,Ve)])]),e("td",null,[e("div",Ue,[e("button",{type:"button",class:"btn btn-outline-main btn-sm",onClick:()=>i.openOrder("edit",n)},"檢視",8,Ae),e("button",{type:"button",class:"btn btn-outline-accent btn-sm",onClick:()=>i.openOrder("delete",n),style:{padding:"0.25rem 0.5rem"}},"刪除",8,Te)])])]))),128))])]),e("div",Be,[e("div",Ie,[h(D,{pages:s.pagination,onChangePage:i.getOrders},null,8,["pages","onChangePage"])]),h(w,{order:s.tempOrder,ref:"orderModal",onUpdateOrder:i.updateOrder,onCancelOrder:i.cancelOrder},null,8,["order","onUpdateOrder","onCancelOrder"]),h(x,{"temp-data":s.tempOrder,ref:"deleteModal",onDelData:i.deleteOrder},null,8,["temp-data","onDelData"])])])])],64)}const je=v(Oe,[["render",Ne]]);export{je as default};
