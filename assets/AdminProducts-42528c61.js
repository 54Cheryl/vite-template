import{P as A,L as D}from"./PaginationView-eba0ecc5.js";import{m as E,D as L}from"./DelModal-d4d1870d.js";import{T as P,S as g}from"./swalToast-5cecdf36.js";import{_ as x,r as h,o as r,c,a as e,b as s,w as M,n as u,F as v,i as C,bu as U,bk as w,d as k,h as q,bg as N,t as _}from"./index-c50289c1.js";const{VITE_APP_URL:F,VITE_APP_PATH:R}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_APP_PATH:"cheryl-hexschool",BASE_URL:"/vite-template/",MODE:"production",DEV:!1,PROD:!0},O={props:{product:{},isNew:{}},data(){return{tempProduct:{},modal:"",imgUploading:!1}},mixins:[E],emits:["update-product","cancel-product","create-images"],watch:{product(){this.tempProduct=this.product,this.tempProduct.imagesUrl||(this.tempProduct.imagesUrl=[]),this.tempProduct.imageUrl||(this.tempProduct.imageUrl="")}},methods:{uploadFile(){this.imgUploading=!0;const i=this.$refs.fileInput.files[0],t=new FormData;t.append("file-to-upload",i),this.$http.post(`${F}api/${R}/admin/upload`,t,{headers:{"Content-Type":"multipart/form-data"}}).then(m=>{m.data.success?(this.tempProduct.tempImage=m.data.imageUrl,this.$refs.fileInput.value="",this.imgUploading=!1,P.fire({icon:"success",title:"上傳成功",text:m.data.message})):(this.$refs.fileInput.value="",this.imgUploading=!1,P.fire({icon:"error",title:"上傳失敗",text:m.data.message}))}).catch(m=>{this.imgUploading=!1,g.fire({icon:"error",title:m.response.data.message})})}}},B={class:"modal fade",id:"productModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},H={class:"modal-dialog modal-xl"},S={class:"modal-content"},j={class:"modal-header bg-dark text-white"},z={class:"modal-title",id:"exampleModalLabel"},G={key:0},J={key:1},K=e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Q={class:"modal-body"},W={class:"col-4"},X={class:"col"},Y=e("label",{class:"form-label mt-2",for:"prodMainImg"},"主要圖片",-1),Z=["src"],$=e("p",{class:"fs-4 mt-2"},"多圖新增",-1),ee={class:"mb-3"},te=e("label",{for:"prodOtherImg",class:"form-label"},"圖片網址",-1),oe=["onUpdate:modelValue"],le=["src"],se={key:0},ie={key:1},de={key:1},ae={class:"col mt-5"},ne={for:"customFile",class:"fs-4 form-label"},re={key:0,class:"fas fa-spinner fa-spin"},ce=e("label",{for:"fileLink",class:"form-label mt-2"},"檔案生成網址",-1),me={class:"col-8"},ue={class:"row"},pe={class:"col-6"},he=e("label",{class:"form-label mt-2",for:"prodTitle"},"品名",-1),_e={class:"col-6"},fe=e("label",{class:"form-label mt-2",for:"prodCategory"},"類別",-1),be={class:"row"},ge={class:"col-6"},Pe=e("label",{class:"form-label mt-2",for:"prodPlace"},"產地",-1),ve={class:"col-6"},Ve=e("label",{class:"form-label mt-2",for:"prodVariety"},"品種",-1),ye={class:"row"},Ue={class:"col-6"},ke=e("label",{class:"form-label mt-2",for:"prodAroma"},"香氣",-1),we={class:"col-6"},xe=e("label",{class:"form-label mt-2",for:"prodTaste"},"滋味",-1),Me={class:"row"},Ce={class:"col-6"},Ie=e("label",{class:"form-label mt-2",for:"prodDried"},"茶乾",-1),Te={class:"col-6"},Ae=e("label",{class:"form-label mt-2",for:"prodUnit"},"單位",-1),De={class:"row"},Ee={class:"col-6"},Le=e("label",{class:"form-label mt-2",for:"prodOrigin"},"原價",-1),qe={class:"col-6"},Ne=e("label",{class:"form-label mt-2",for:"prodPrice"},"售價",-1),Fe=e("label",{class:"form-label mt-2",for:"prodDescription"},"產品描述",-1),Re=e("label",{class:"form-label mt-2",for:"prodContent"},"說明內容",-1),Oe={class:"col mt-2"},Be=e("label",{class:"form-label ms-2",for:"prodEnabled"},"是否啟用",-1),He={class:"modal-footer"};function Se(i,t,m,I,o,p){const d=h("VField"),a=h("ErrorMessage"),V=h("VForm");return r(),c("div",B,[e("div",H,[e("div",S,[e("div",j,[e("h5",z,[m.isNew?(r(),c("span",G,"新增產品")):(r(),c("span",J,"編輯產品"))]),K]),e("div",Q,[s(V,{class:"row"},{default:M(({errors:n})=>[e("div",W,[e("div",X,[Y,s(d,{id:"prodMainImg",name:"主要圖片",type:"text",class:u(["form-control mb-2",{"is-invalid":n.主要圖片}]),placeholder:"請輸入圖片連結",rules:"required",modelValue:o.tempProduct.imageUrl,"onUpdate:modelValue":t[0]||(t[0]=l=>o.tempProduct.imageUrl=l)},null,8,["class","modelValue"]),s(a,{name:"主要圖片",class:"invalid-feedback"}),e("img",{src:o.tempProduct.imageUrl,alt:"產品主要圖片",class:"img-fluid"},null,8,Z)]),$,Array.isArray(o.tempProduct.imagesUrl)?(r(),c(v,{key:0},[(r(!0),c(v,null,C(o.tempProduct.imagesUrl,(l,y)=>(r(),c("div",{class:"mb-1",key:y},[e("div",ee,[te,U(e("input",{"onUpdate:modelValue":T=>o.tempProduct.imagesUrl[y]=T,type:"text",class:"form-control",id:"prodOtherImg",placeholder:"請輸入圖片連結"},null,8,oe),[[w,o.tempProduct.imagesUrl[y]]])]),e("img",{class:"img-fluid",src:l,alt:"產品相關圖片"},null,8,le)]))),128)),!o.tempProduct.imagesUrl.length||o.tempProduct.imagesUrl[o.tempProduct.imagesUrl.length-1]?(r(),c("div",se,[e("button",{type:"button",class:"btn btn-outline-main btn-sm d-block w-100",onClick:t[1]||(t[1]=()=>o.tempProduct.imagesUrl.push(""))}," 新增圖片 ")])):(r(),c("div",ie,[e("button",{type:"button",class:"btn btn-outline-accent btn-sm d-block w-100",style:{padding:"0.25rem 0.5rem"},onClick:t[2]||(t[2]=()=>o.tempProduct.imagesUrl.pop())}," 刪除圖片 ")]))],64)):(r(),c("div",de,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm d-block w-100",onClick:t[3]||(t[3]=()=>i.$emit("create-images"))}," 新增圖片 ")])),e("div",ae,[e("label",ne,[k("上傳圖檔 "),o.imgUploading?(r(),c("i",re)):q("",!0)]),e("input",{type:"file",name:"file-to-upload",id:"customFile",class:"form-control mb-2",ref:"fileInput",onChange:t[4]||(t[4]=(...l)=>p.uploadFile&&p.uploadFile(...l))},null,544),ce,U(e("input",{type:"text",class:"form-control mb-2",id:"fileLink",placeholder:"請複製用於上方圖片連結","onUpdate:modelValue":t[5]||(t[5]=l=>o.tempProduct.tempImage=l)},null,512),[[w,o.tempProduct.tempImage]])])]),e("div",me,[e("div",ue,[e("div",pe,[he,s(d,{id:"prodTitle",name:"品名",type:"text",class:u(["form-control",{"is-invalid":n.品名}]),placeholder:"請輸入品名",rules:"required",modelValue:o.tempProduct.title,"onUpdate:modelValue":t[6]||(t[6]=l=>o.tempProduct.title=l)},null,8,["class","modelValue"]),s(a,{name:"品名",class:"invalid-feedback"})]),e("div",_e,[fe,s(d,{id:"prodCategory",name:"類別",type:"text",class:u(["form-control",{"is-invalid":n.類別}]),placeholder:"請輸入類別",rules:"required",modelValue:o.tempProduct.category,"onUpdate:modelValue":t[7]||(t[7]=l=>o.tempProduct.category=l)},null,8,["class","modelValue"]),s(a,{name:"類別",class:"invalid-feedback"})])]),e("div",be,[e("div",ge,[Pe,s(d,{id:"prodPlace",name:"產地",type:"text",class:u(["form-control",{"is-invalid":n.產地}]),placeholder:"請輸入產地",rules:"required",modelValue:o.tempProduct.origin_place,"onUpdate:modelValue":t[8]||(t[8]=l=>o.tempProduct.origin_place=l)},null,8,["class","modelValue"]),s(a,{name:"產地",class:"invalid-feedback"})]),e("div",ve,[Ve,s(d,{id:"prodVariety",name:"品種",type:"text",class:u(["form-control",{"is-invalid":n.品種}]),placeholder:"請輸入品種",rules:"required",modelValue:o.tempProduct.variety,"onUpdate:modelValue":t[9]||(t[9]=l=>o.tempProduct.variety=l)},null,8,["class","modelValue"]),s(a,{name:"品種",class:"invalid-feedback"})])]),e("div",ye,[e("div",Ue,[ke,s(d,{id:"prodAroma",name:"香氣",type:"text",class:u(["form-control",{"is-invalid":n.香氣}]),placeholder:"請輸入香氣",rules:"required",modelValue:o.tempProduct.aroma,"onUpdate:modelValue":t[10]||(t[10]=l=>o.tempProduct.aroma=l)},null,8,["class","modelValue"]),s(a,{name:"香氣",class:"invalid-feedback"})]),e("div",we,[xe,s(d,{id:"prodTaste",name:"滋味",type:"text",class:u(["form-control",{"is-invalid":n.滋味}]),placeholder:"請輸入滋味",rules:"required",modelValue:o.tempProduct.taste,"onUpdate:modelValue":t[11]||(t[11]=l=>o.tempProduct.taste=l)},null,8,["class","modelValue"]),s(a,{name:"滋味",class:"invalid-feedback"})])]),e("div",Me,[e("div",Ce,[Ie,s(d,{id:"prodDried",name:"茶乾",type:"text",class:u(["form-control",{"is-invalid":n.滋味}]),placeholder:"請輸入茶乾",rules:"required",modelValue:o.tempProduct.tea_dried,"onUpdate:modelValue":t[12]||(t[12]=l=>o.tempProduct.tea_dried=l)},null,8,["class","modelValue"]),s(a,{name:"茶乾",class:"invalid-feedback"})]),e("div",Te,[Ae,s(d,{id:"prodUnit",name:"單位",type:"text",class:u(["form-control",{"is-invalid":n.單位}]),placeholder:"請輸入單位",rules:"required",modelValue:o.tempProduct.unit,"onUpdate:modelValue":t[13]||(t[13]=l=>o.tempProduct.unit=l)},null,8,["class","modelValue"]),s(a,{name:"單位",class:"invalid-feedback"})])]),e("div",De,[e("div",Ee,[Le,s(d,{id:"prodOrigin",name:"原價",type:"number",min:"0",class:u(["form-control",{"is-invalid":n.原價}]),placeholder:"請輸入原價",rules:"required",modelValue:o.tempProduct.origin_price,"onUpdate:modelValue":t[14]||(t[14]=l=>o.tempProduct.origin_price=l),modelModifiers:{number:!0}},null,8,["class","modelValue"]),s(a,{name:"原價",class:"invalid-feedback"})]),e("div",qe,[Ne,s(d,{id:"prodPrice",name:"售價",type:"number",min:"0",class:u(["form-control",{"is-invalid":n.售價}]),placeholder:"請輸入售價",rules:"required",modelValue:o.tempProduct.price,"onUpdate:modelValue":t[15]||(t[15]=l=>o.tempProduct.price=l),modelModifiers:{number:!0}},null,8,["class","modelValue"]),s(a,{name:"售價",class:"invalid-feedback"})])]),Fe,s(d,{as:"textarea",id:"prodDescription",name:"描述",class:u(["form-control",{"is-invalid":n.描述}]),cols:"30",rows:"2",placeholder:"請輸入產品描述",rules:"required",modelValue:o.tempProduct.description,"onUpdate:modelValue":t[16]||(t[16]=l=>o.tempProduct.description=l)},null,8,["class","modelValue"]),s(a,{name:"描述",class:"invalid-feedback"}),Re,s(d,{as:"textarea",id:"prodContent",name:"說明",class:u(["form-control",{"is-invalid":n.說明}]),cols:"30",rows:"2",placeholder:"請輸入說明內容",rules:"required",modelValue:o.tempProduct.content,"onUpdate:modelValue":t[17]||(t[17]=l=>o.tempProduct.content=l)},null,8,["class","modelValue"]),s(a,{name:"說明",class:"invalid-feedback"}),e("div",Oe,[U(e("input",{type:"checkbox",class:"form-check-input",id:"prodEnabled","onUpdate:modelValue":t[18]||(t[18]=l=>o.tempProduct.is_enabled=l),"true-value":1,"false-value":0},null,512),[[N,o.tempProduct.is_enabled]]),Be])])]),_:1})]),e("div",He,[e("button",{type:"button",class:"btn btn-outline-n500","data-bs-dismiss":"modal",onClick:t[19]||(t[19]=()=>i.$emit("cancel-product"))},"取消"),e("button",{type:"button",class:"btn btn-custom",style:{"padding-left":"1.5rem"},onClick:t[20]||(t[20]=()=>i.$emit("update-product"))},"確認")])])])],512)}const je=x(O,[["render",Se]]),{VITE_APP_URL:f,VITE_APP_PATH:b}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_APP_PATH:"cheryl-hexschool",BASE_URL:"/vite-template/",MODE:"production",DEV:!1,PROD:!0},ze={props:["token"],data(){return{products:[],pagination:{},isNew:!1,tempProduct:{imagesUrl:[],tempImage:""},isLoading:!1,fullPage:!0}},methods:{getProducts(i=1){this.isLoading=!0,this.$http.get(`${f}api/${b}/admin/products/?page=${i}`).then(t=>{this.isLoading=!1,this.products=t.data.products,this.pagination=t.data.pagination}).catch(t=>{g.fire({icon:"error",title:t.response.data.message})})},openProduct(i,t){i==="new"?(this.isNew=!0,this.tempProduct={imagesUrl:[],is_enabled:0},this.$refs.productModal.showModal()):i==="edit"?(this.isNew=!1,this.tempProduct={...t},this.$refs.productModal.showModal()):i==="delete"&&(this.tempProduct={...t},this.$refs.deleteModal.showModal())},cancelProduct(){this.tempProduct={imagesUrl:[]},this.$refs.productModal.hideModal()},updateProduct(){let i=`${f}api/${b}/admin/product`,t="post";this.isNew||(i=`${f}api/${b}/admin/product/${this.tempProduct.id}`,t="put"),this.tempProduct.tempImage="",this.$http[t](i,{data:this.tempProduct}).then(m=>{P.fire({icon:"success",title:m.data.message}),this.tempProduct={imagesUrl:[],tempImage:""},this.$refs.productModal.hideModal(),this.getProducts()}).catch(m=>{g.fire({icon:"error",title:m.response.data.message})})},createImages(){this.tempProduct.imagesUrl.push("")},deleteProduct(){const i=`${f}api/${b}/admin/product/${this.tempProduct.id}`;this.$http.delete(i).then(t=>{P.fire({icon:"success",title:t.data.message}),this.$refs.deleteModal.hideModal(),this.getProducts()}).catch(t=>{g.fire({icon:"error",title:t.response.data.message})})}},components:{Pagination:A,DelModal:L,ProdModal:je,Loading:D},mounted(){this.getProducts()}},Ge=e("div",{class:"loadingio-spinner-spin-ekq2gap1645"},[e("div",{class:"ldio-kyayy0fncmo"},[e("div",null,[e("div")]),e("div",null,[e("div")]),e("div",null,[e("div")]),e("div",null,[e("div")]),e("div",null,[e("div")]),e("div",null,[e("div")]),e("div",null,[e("div")]),e("div",null,[e("div")])])],-1),Je={class:"container",style:{"margin-top":"7vh"}},Ke={class:"pt-5"},Qe={class:"d-flex justify-content-between"},We={class:"mb-0 px-2 d-flex align-items-center"},Xe={class:"text-end"},Ye={class:"table table-hover mt-2"},Ze=e("thead",null,[e("tr",null,[e("th",{width:"120"},"分類"),e("th",{width:"150"},"產品名稱"),e("th",{width:"120"}," 原價 "),e("th",{width:"120"}," 售價 "),e("th",{width:"150"}," 是否啟用 "),e("th",{width:"120"}," 編輯 ")])],-1),$e={width:"120"},et={width:"150"},tt={width:"120"},ot={width:"120"},lt={width:"150"},st={key:0,class:"text-success"},it={key:1},dt={width:"120"},at=["onClick"],nt=["onClick"],rt={class:"row"},ct={class:"col"};function mt(i,t,m,I,o,p){const d=h("Loading"),a=h("Pagination"),V=h("ProdModal"),n=h("DelModal");return r(),c(v,null,[s(d,{active:o.isLoading,"onUpdate:active":t[0]||(t[0]=l=>o.isLoading=l),"can-cancel":!0,"is-full-page":o.fullPage},{default:M(()=>[Ge]),_:1},8,["active","is-full-page"]),e("div",Je,[e("div",Ke,[e("div",Qe,[e("p",We,[k("本頁有 "),e("span",null,_(o.products.length),1),k(" 項產品")]),e("div",Xe,[e("button",{type:"button",class:"btn btn-custom text-light",onClick:t[1]||(t[1]=()=>p.openProduct("new",i.item)),style:{"padding-left":"1.5rem"}},"新增產品")])]),e("table",Ye,[Ze,e("tbody",null,[(r(!0),c(v,null,C(o.products,l=>(r(),c("tr",{key:l.id},[e("td",$e,_(l.category),1),e("td",et,_(l.title),1),e("td",tt,_(l.origin_price),1),e("td",ot,_(l.price),1),e("td",lt,[l.is_enabled?(r(),c("span",st,"啟用")):(r(),c("span",it,"未啟用"))]),e("td",dt,[e("button",{type:"button",class:"btn btn-outline-main btn-sm me-2 backendBtn",onClick:()=>p.openProduct("edit",l)},"編輯",8,at),e("button",{type:"button",class:"btn btn-outline-accent btn-sm",onClick:()=>p.openProduct("delete",l),style:{padding:"0.25rem 0.5rem"}},"刪除",8,nt)])]))),128))])]),e("div",rt,[e("div",ct,[s(a,{pages:o.pagination,onChangePage:p.getProducts},null,8,["pages","onChangePage"])]),s(V,{product:o.tempProduct,isNew:o.isNew,ref:"productModal",onUpdateProduct:p.updateProduct,onCancelProduct:p.cancelProduct,onCreateImages:p.createImages},null,8,["product","isNew","onUpdateProduct","onCancelProduct","onCreateImages"]),s(n,{"temp-data":o.tempProduct,ref:"deleteModal",onDelData:p.deleteProduct},null,8,["temp-data","onDelData"])])])])],64)}const ft=x(ze,[["render",mt]]);export{ft as default};
