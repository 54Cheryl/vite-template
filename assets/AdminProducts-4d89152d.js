import{P as M,L as I}from"./PaginationView-f1fedf59.js";import{m as C,D as L}from"./DelModal-76dada39.js";import{T as b,S as g}from"./swalToast-f80a10dc.js";import{_ as w,o as n,c as r,a as t,bt as i,bj as d,F as v,k as x,d as y,l as A,bf as T,r as h,b as _,t as u}from"./index-c351061a.js";const{VITE_APP_URL:D,VITE_APP_PATH:E}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_APP_PATH:"cheryl-hexschool",BASE_URL:"/vite-template/",MODE:"production",DEV:!1,PROD:!0},N={props:{product:{},isNew:{}},data(){return{tempProduct:{},modal:"",imgUploading:!1}},mixins:[C],emits:["update-product","cancel-product","create-images"],watch:{product(){this.tempProduct=this.product,this.tempProduct.imagesUrl||(this.tempProduct.imagesUrl=[]),this.tempProduct.imageUrl||(this.tempProduct.imageUrl="")}},methods:{uploadFile(){this.imgUploading=!0;const l=this.$refs.fileInput.files[0],e=new FormData;e.append("file-to-upload",l),this.$http.post(`${D}api/${E}/admin/upload`,e,{headers:{"Content-Type":"multipart/form-data"}}).then(c=>{c.data.success?(this.tempProduct.tempImage=c.data.imageUrl,this.$refs.fileInput.value="",this.imgUploading=!1,b.fire({icon:"success",title:"上傳成功",text:c.data.message})):(this.$refs.fileInput.value="",this.imgUploading=!1,b.fire({icon:"error",title:"上傳失敗",text:c.data.message}))}).catch(c=>{this.imgUploading=!1,g.fire({icon:"error",title:c.response.data.message})})}}},R={class:"modal fade",id:"productModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},F={class:"modal-dialog modal-xl"},B={class:"modal-content"},H={class:"modal-header bg-dark text-white"},S={class:"modal-title",id:"exampleModalLabel"},O={key:0},j={key:1},q=t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),z={class:"modal-body"},G={action:"",class:"row"},J={class:"col-4"},K={class:"col"},Q=t("label",{class:"form-label mt-2",for:""},"主要圖片",-1),W=["src"],X=t("p",{class:"fs-4 mt-2"},"多圖新增",-1),Y={class:"mb-3"},Z=t("label",{for:"",class:"form-label"},"圖片網址",-1),$=["onUpdate:modelValue"],tt=["src"],et={key:0},ot={key:1},st={key:1},lt={class:"col mt-5"},it={for:"customFile",class:"fs-4 form-label"},dt={key:0,class:"fas fa-spinner fa-spin"},nt=t("label",{for:"fileLink",class:"form-label mt-2"},"檔案生成網址",-1),rt={class:"col-8"},ct={class:"row"},at={class:"col-6"},mt=t("label",{class:"form-label mt-2",for:""},"品名",-1),pt={class:"col-6"},ut=t("label",{class:"form-label mt-2",for:""},"類別",-1),ht={class:"row"},_t={class:"col-6"},ft=t("label",{class:"form-label mt-2",for:""},"產地",-1),Pt={class:"col-6"},gt=t("label",{class:"form-label mt-2",for:""},"品種",-1),bt={class:"row"},vt={class:"col-6"},Ut=t("label",{class:"form-label mt-2",for:""},"香氣",-1),yt={class:"col-6"},wt=t("label",{class:"form-label mt-2",for:""},"滋味",-1),xt={class:"row"},kt={class:"col-6"},Vt=t("label",{class:"form-label mt-2",for:""},"茶乾",-1),Mt={class:"col-6"},It=t("label",{class:"form-label mt-2",for:""},"單位",-1),Ct={class:"row"},Lt={class:"col-6"},At=t("label",{class:"form-label mt-2",for:""},"原價",-1),Tt={class:"col-6"},Dt=t("label",{class:"form-label mt-2",for:""},"售價",-1),Et=t("label",{class:"form-label mt-2",for:""},"產品描述",-1),Nt=t("label",{class:"form-label mt-2",for:""},"說明內容",-1),Rt={class:"col mt-2"},Ft=t("label",{class:"form-label ms-2",for:""},"是否啟用",-1),Bt={class:"modal-footer"};function Ht(l,e,c,k,o,a){return n(),r("div",R,[t("div",F,[t("div",B,[t("div",H,[t("h5",S,[c.isNew?(n(),r("span",O,"新增產品")):(n(),r("span",j,"編輯產品"))]),q]),t("div",z,[t("form",G,[t("div",J,[t("div",K,[Q,i(t("input",{type:"text",class:"form-control mb-2",id:"",placeholder:"請輸入圖片連結","onUpdate:modelValue":e[0]||(e[0]=s=>o.tempProduct.imageUrl=s)},null,512),[[d,o.tempProduct.imageUrl]]),t("img",{src:o.tempProduct.imageUrl,alt:"",class:"img-fluid"},null,8,W)]),X,Array.isArray(o.tempProduct.imagesUrl)?(n(),r(v,{key:0},[(n(!0),r(v,null,x(o.tempProduct.imagesUrl,(s,p)=>(n(),r("div",{class:"mb-1",key:p},[t("div",Y,[Z,i(t("input",{"onUpdate:modelValue":U=>o.tempProduct.imagesUrl[p]=U,type:"text",class:"form-control",placeholder:"請輸入圖片連結"},null,8,$),[[d,o.tempProduct.imagesUrl[p]]])]),t("img",{class:"img-fluid",src:s},null,8,tt)]))),128)),!o.tempProduct.imagesUrl.length||o.tempProduct.imagesUrl[o.tempProduct.imagesUrl.length-1]?(n(),r("div",et,[t("button",{class:"btn btn-outline-main btn-sm d-block w-100",onClick:e[1]||(e[1]=()=>o.tempProduct.imagesUrl.push(""))}," 新增圖片 ")])):(n(),r("div",ot,[t("button",{class:"btn btn-outline-accent btn-sm d-block w-100",style:{padding:"0.25rem 0.5rem"},onClick:e[2]||(e[2]=()=>o.tempProduct.imagesUrl.pop())}," 刪除圖片 ")]))],64)):(n(),r("div",st,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[3]||(e[3]=()=>l.$emit("create-images"))}," 新增圖片 ")])),t("div",lt,[t("label",it,[y("上傳圖檔 "),o.imgUploading?(n(),r("i",dt)):A("",!0)]),t("input",{type:"file",name:"file-to-upload",id:"customFile",class:"form-control mb-2",ref:"fileInput",onChange:e[4]||(e[4]=(...s)=>a.uploadFile&&a.uploadFile(...s))},null,544),nt,i(t("input",{type:"text",class:"form-control mb-2",id:"fileLink",placeholder:"請複製用於上方圖片連結","onUpdate:modelValue":e[5]||(e[5]=s=>o.tempProduct.tempImage=s)},null,512),[[d,o.tempProduct.tempImage]])])]),t("div",rt,[t("div",ct,[t("div",at,[mt,i(t("input",{type:"text",class:"form-control",id:"",placeholder:"請輸入品名","onUpdate:modelValue":e[6]||(e[6]=s=>o.tempProduct.title=s)},null,512),[[d,o.tempProduct.title]])]),t("div",pt,[ut,i(t("input",{type:"text",class:"form-control",id:"",placeholder:"請輸入類別","onUpdate:modelValue":e[7]||(e[7]=s=>o.tempProduct.category=s)},null,512),[[d,o.tempProduct.category]])])]),t("div",ht,[t("div",_t,[ft,i(t("input",{type:"text",class:"form-control",id:"",placeholder:"請輸入產地","onUpdate:modelValue":e[8]||(e[8]=s=>o.tempProduct.origin_place=s)},null,512),[[d,o.tempProduct.origin_place]])]),t("div",Pt,[gt,i(t("input",{type:"text",class:"form-control",id:"",placeholder:"請輸入品種","onUpdate:modelValue":e[9]||(e[9]=s=>o.tempProduct.variety=s)},null,512),[[d,o.tempProduct.variety]])])]),t("div",bt,[t("div",vt,[Ut,i(t("input",{type:"text",class:"form-control",id:"",placeholder:"請輸入香氣","onUpdate:modelValue":e[10]||(e[10]=s=>o.tempProduct.aroma=s)},null,512),[[d,o.tempProduct.aroma]])]),t("div",yt,[wt,i(t("input",{type:"text",class:"form-control",id:"",placeholder:"請輸入滋味","onUpdate:modelValue":e[11]||(e[11]=s=>o.tempProduct.taste=s)},null,512),[[d,o.tempProduct.taste]])])]),t("div",xt,[t("div",kt,[Vt,i(t("input",{type:"text",class:"form-control",id:"",placeholder:"請輸入茶乾","onUpdate:modelValue":e[12]||(e[12]=s=>o.tempProduct.tea_dried=s)},null,512),[[d,o.tempProduct.tea_dried]])]),t("div",Mt,[It,i(t("input",{type:"text",class:"form-control",id:"",placeholder:"請輸入單位","onUpdate:modelValue":e[13]||(e[13]=s=>o.tempProduct.unit=s)},null,512),[[d,o.tempProduct.unit]])])]),t("div",Ct,[t("div",Lt,[At,i(t("input",{type:"number",min:"0",class:"form-control",id:"",placeholder:"請輸入原價","onUpdate:modelValue":e[14]||(e[14]=s=>o.tempProduct.origin_price=s)},null,512),[[d,o.tempProduct.origin_price,void 0,{number:!0}]])]),t("div",Tt,[Dt,i(t("input",{type:"number",min:"0",class:"form-control",id:"",placeholder:"請輸入售價","onUpdate:modelValue":e[15]||(e[15]=s=>o.tempProduct.price=s)},null,512),[[d,o.tempProduct.price,void 0,{number:!0}]])])]),Et,i(t("textarea",{class:"form-control",id:"",cols:"30",rows:"2",placeholder:"請輸入產品描述","onUpdate:modelValue":e[16]||(e[16]=s=>o.tempProduct.description=s)},null,512),[[d,o.tempProduct.description]]),Nt,i(t("textarea",{class:"form-control",id:"",cols:"30",rows:"2",placeholder:"請輸入說明內容","onUpdate:modelValue":e[17]||(e[17]=s=>o.tempProduct.content=s)},null,512),[[d,o.tempProduct.content]]),t("div",Rt,[i(t("input",{type:"checkbox",class:"form-check-input",id:"","onUpdate:modelValue":e[18]||(e[18]=s=>o.tempProduct.is_enabled=s),"true-value":1,"false-value":0},null,512),[[T,o.tempProduct.is_enabled]]),Ft])])])]),t("div",Bt,[t("button",{type:"button",class:"btn btn-outline-n500","data-bs-dismiss":"modal",onClick:e[19]||(e[19]=()=>l.$emit("cancel-product"))},"取消"),t("button",{type:"button",class:"btn btn-custom",style:{"padding-left":"1.5rem"},onClick:e[20]||(e[20]=()=>l.$emit("update-product"))},"確認")])])])],512)}const St=w(N,[["render",Ht]]),{VITE_APP_URL:f,VITE_APP_PATH:P}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_APP_PATH:"cheryl-hexschool",BASE_URL:"/vite-template/",MODE:"production",DEV:!1,PROD:!0},Ot={props:["token"],data(){return{products:[],pagination:{},isNew:!1,tempProduct:{imagesUrl:[],tempImage:""},isLoading:!1,fullPage:!0}},methods:{getProducts(l=1){this.isLoading=!0,this.$http.get(`${f}api/${P}/admin/products/?page=${l}`).then(e=>{this.isLoading=!1,this.products=e.data.products,this.pagination=e.data.pagination}).catch(e=>{g.fire({icon:"error",title:e.response.data.message})})},openProduct(l,e){l==="new"?(this.isNew=!0,this.tempProduct={imagesUrl:[]},this.$refs.productModal.showModal()):l==="edit"?(this.isNew=!1,this.tempProduct={...e},this.$refs.productModal.showModal()):l==="delete"&&(this.tempProduct={...e},this.$refs.deleteModal.showModal())},cancelProduct(){this.tempProduct={imagesUrl:[]},this.$refs.productModal.hideModal()},updateProduct(){let l=`${f}api/${P}/admin/product`,e="post";this.isNew||(l=`${f}api/${P}/admin/product/${this.tempProduct.id}`,e="put"),this.tempProduct.tempImage="",this.$http[e](l,{data:this.tempProduct}).then(c=>{b.fire({icon:"success",title:c.data.message}),this.tempProduct={imagesUrl:[],tempImage:""},this.$refs.productModal.hideModal(),this.getProducts()}).catch(c=>{g.fire({icon:"error",title:c.response.data.message})})},createImages(){this.tempProduct.imagesUrl.push("")},deleteProduct(){const l=`${f}api/${P}/admin/product/${this.tempProduct.id}`;this.$http.delete(l).then(e=>{b.fire({icon:"success",title:e.data.message}),this.$refs.deleteModal.hideModal(),this.getProducts()}).catch(e=>{g.fire({icon:"error",title:e.response.data.message})})}},components:{Pagination:M,DelModal:L,ProdModal:St,Loading:I},mounted(){this.getProducts()}},jt={class:"container",style:{"margin-top":"7vh"}},qt={class:"pt-5"},zt={class:"d-flex justify-content-between"},Gt={class:"mb-0 px-2"},Jt={class:"text-end"},Kt={class:"table table-hover mt-2"},Qt=t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",{width:"150"},"產品名稱"),t("th",{width:"120"}," 原價 "),t("th",{width:"120"}," 售價 "),t("th",{width:"150"}," 是否啟用 "),t("th",{width:"120"}," 編輯 ")])],-1),Wt={width:"120"},Xt={width:"150"},Yt={width:"120"},Zt={width:"120"},$t={width:"150"},te={key:0,class:"text-success"},ee={key:1},oe={width:"120"},se=["onClick"],le=["onClick"],ie={class:"row"},de={class:"col"};function ne(l,e,c,k,o,a){const s=h("Loading"),p=h("Pagination"),U=h("ProdModal"),V=h("DelModal");return n(),r(v,null,[_(s,{active:o.isLoading,"onUpdate:active":e[0]||(e[0]=m=>o.isLoading=m),"can-cancel":!0,"is-full-page":o.fullPage},null,8,["active","is-full-page"]),t("div",jt,[t("div",qt,[t("div",zt,[t("p",Gt,[y("本頁有 "),t("span",null,u(o.products.length),1),y(" 項產品")]),t("div",Jt,[t("button",{type:"button",class:"btn btn-custom text-light",onClick:e[1]||(e[1]=()=>a.openProduct("new",l.item)),style:{"padding-left":"1.5rem"}},"新增產品")])]),t("table",Kt,[Qt,t("tbody",null,[(n(!0),r(v,null,x(o.products,m=>(n(),r("tr",{key:m.id},[t("td",Wt,u(m.category),1),t("td",Xt,u(m.title),1),t("td",Yt,u(m.origin_price),1),t("td",Zt,u(m.price),1),t("td",$t,[m.is_enabled?(n(),r("span",te,"啟用")):(n(),r("span",ee,"未啟用"))]),t("td",oe,[t("button",{type:"button",class:"btn btn-outline-main btn-sm me-2 backendBtn",onClick:()=>a.openProduct("edit",m)},"編輯",8,se),t("button",{type:"button",class:"btn btn-outline-accent btn-sm",onClick:()=>a.openProduct("delete",m),style:{padding:"0.25rem 0.5rem"}},"刪除",8,le)])]))),128))])]),t("div",ie,[t("div",de,[_(p,{pages:o.pagination,onChangePage:a.getProducts},null,8,["pages","onChangePage"])]),_(U,{product:o.tempProduct,isNew:o.isNew,ref:"productModal",onUpdateProduct:a.updateProduct,onCancelProduct:a.cancelProduct,onCreateImages:a.createImages},null,8,["product","isNew","onUpdateProduct","onCancelProduct","onCreateImages"]),_(V,{"temp-data":o.tempProduct,ref:"deleteModal",onDelData:a.deleteProduct},null,8,["temp-data","onDelData"])])])])],64)}const pe=w(Ot,[["render",ne]]);export{pe as default};
