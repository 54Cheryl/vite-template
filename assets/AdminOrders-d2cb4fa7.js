import{P as L,L as V}from"./PaginationView-d6d9f6e2.js";import{m as E,D as S}from"./DelModal-dcd290cc.js";import{_ as $,o as l,c as n,a as e,t as d,h as y,bu as M,bg as C,F as b,i as v,r as u,b as _,w as U,d as k}from"./index-3e315e58.js";import{S as h,T as O}from"./swalToast-e65c17dd.js";const A={props:{order:{}},data(){return{modal:"",tempOrder:{}}},watch:{order(){this.tempOrder=this.order}},mixins:[E],emits:["cancel-order","update-order"]},T={class:"modal fade",id:"orderModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},B={class:"modal-dialog modal-xl"},I={class:"modal-content"},N=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},[e("span",null,"訂單細節")]),e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),R={class:"modal-body"},q={class:"row"},j={class:"col-4"},F=e("h3",null,"用戶資料",-1),H={class:"table"},z={key:0},G=e("th",null,"姓名",-1),J=e("th",null,"Email",-1),K=e("th",null,"電話",-1),Q=e("th",null,"地址",-1),W={key:0},X=e("th",null,"留言",-1),Y={class:"col-8"},Z=e("h3",null,"訂單細節",-1),ee={class:"table"},te=e("th",null,"訂單編號",-1),se=e("th",null,"下單時間",-1),oe=e("th",null,"付款時間",-1),de={key:0},le={key:1},ne=e("th",null,"付款狀態",-1),re={class:"form-check form-switch"},ie=["for"],ae={key:0,class:"text-success"},ce={key:1,class:"text-danger"},pe=["id"],ue=e("th",null,"總金額",-1),_e=e("h3",null,"購買品項",-1),he={class:"table"},me={class:"text-end"},fe={class:"modal-footer"};function be(o,t,g,c,s,a){return l(),n("div",T,[e("div",B,[e("div",I,[N,e("div",R,[e("div",q,[e("div",j,[F,e("table",H,[s.tempOrder.user?(l(),n("tbody",z,[e("tr",null,[G,e("td",null,d(s.tempOrder.user.name),1)]),e("tr",null,[J,e("td",null,d(s.tempOrder.user.email),1)]),e("tr",null,[K,e("td",null,d(s.tempOrder.user.tel),1)]),e("tr",null,[Q,e("td",null,d(s.tempOrder.user.address),1)]),s.tempOrder.message?(l(),n("tr",W,[X,e("td",null,d(s.tempOrder.message),1)])):y("",!0)])):y("",!0)])]),e("div",Y,[Z,e("table",ee,[e("tbody",null,[e("tr",null,[te,e("td",null,d(s.tempOrder.id),1)]),e("tr",null,[se,e("td",null,d(o.$filters.date(s.tempOrder.create_at)),1)]),e("tr",null,[oe,e("td",null,[s.tempOrder.paid_date?(l(),n("span",de,d(s.tempOrder.paid_date),1)):(l(),n("span",le,"時間不正確"))])]),e("tr",null,[ne,e("td",null,[e("template",re,[e("label",{class:"form-check-label",for:`paidSwitch${s.tempOrder.id}`},[s.tempOrder.is_paid?(l(),n("strong",ae,"已付款")):(l(),n("strong",ce,"未付款"))],8,ie),M(e("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${s.tempOrder.id}`,"onUpdate:modelValue":t[0]||(t[0]=i=>s.tempOrder.is_paid=i)},null,8,pe),[[C,s.tempOrder.is_paid]])])])]),e("tr",null,[ue,e("td",null," $ "+d(o.$filters.currency(s.tempOrder.total)),1)])])]),_e,e("table",he,[e("tbody",null,[(l(!0),n(b,null,v(s.tempOrder.products,i=>(l(),n("tr",{key:i.id},[e("th",null,d(i.product.title),1),e("td",null,d(i.qty)+" / "+d(i.product.unit),1),e("td",me," $ "+d(o.$filters.currency(i.final_total)),1)]))),128))])])])])]),e("div",fe,[e("button",{type:"button",class:"btn btn-outline-n500","data-bs-dismiss":"modal",onClick:t[1]||(t[1]=()=>o.$emit("cancel-order"))},"取消"),e("button",{type:"button",class:"btn btn-custom",style:{"padding-left":"1.5rem"},onClick:t[2]||(t[2]=()=>o.$emit("update-order"))},"確認")])])])],512)}const ge=$(A,[["render",be]]);const{VITE_APP_URL:m,VITE_APP_PATH:f}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_APP_PATH:"cheryl-hexschool",BASE_URL:"/vite-template/",MODE:"production",DEV:!1,PROD:!0},Oe={props:["token"],data(){return{orders:[],pagination:{},tempOrder:{},isLoading:!1,fullPage:!0}},methods:{getOrders(o=1){this.isLoading=!0,this.$http.get(`${m}api/${f}/admin/orders/?page=${o}`).then(t=>{this.isLoading=!1,this.orders=t.data.orders,this.pagination=t.data.pagination}).catch(t=>{h.fire({icon:"error",title:t.response.data.message,confirmButtonColor:"#ab7e52"})})},updatePaid(o){if(o.is_paid){const c=new Date().toLocaleDateString();o.paid_date=c}else o.paid_date="";const t={is_paid:o.is_paid,paid_date:o.paid_date};O.fire({icon:"success",title:"已更新訂單資訊"});const g=`${m}api/${f}/admin/order/${o.id}`;this.$http.put(g,{data:t}).then(c=>{this.getOrders()}).catch(c=>{h.fire({icon:"error",title:c.response.data.message,confirmButtonColor:"#ab7e52"})})},openOrder(o,t){o==="edit"?(this.tempOrder={...t},this.$refs.orderModal.showModal()):o==="delete"&&(this.tempOrder={...t},this.$refs.deleteModal.showModal())},cancelOrder(){this.tempOrder={},this.$refs.OrderModal.hideModal()},updateOrder(){const o=`${m}api/${f}/admin/order/${this.tempOrder.id}`;if(this.tempOrder.is_paid){const t=new Date().toLocaleDateString();this.tempOrder.paid_date=t}else this.tempOrder.paid_date="";this.$http.put(o,{data:this.tempOrder}).then(t=>{this.$refs.orderModal.hideModal(),this.tempOrder={},this.getOrders(),O.fire({icon:"success",title:t.data.message})}).catch(t=>{h.fire({icon:"error",title:t.response.data.message,confirmButtonColor:"#ab7e52"})})},deleteOrder(){const o=`${m}api/${f}/admin/order/${this.tempOrder.id}`;this.$http.delete(o).then(t=>{this.$refs.deleteModal.hideModal(),this.getOrders(),O.fire({icon:"success",title:t.data.message})}).catch(t=>{h.fire({icon:"error",title:t.response.data.message,confirmButtonColor:"#ab7e52"})})}},components:{Pagination:L,DelModal:S,OrderModal:ge,Loading:V},mounted(){this.getOrders()}},ve=e("div",{class:"loadingio-spinner-spin-ekq2gap1645"},[e("div",{class:"ldio-kyayy0fncmo"},[e("div",null,[e("div")]),e("div",null,[e("div")]),e("div",null,[e("div")]),e("div",null,[e("div")]),e("div",null,[e("div")]),e("div",null,[e("div")]),e("div",null,[e("div")]),e("div",null,[e("div")])])],-1),ye={class:"container",style:{"margin-top":"7vh"}},ke={class:"pt-5"},$e={class:"mb-0 px-2 d-flex align-items-center"},Me={class:"table table-hover mt-2"},Ce=e("thead",null,[e("tr",null,[e("th",null,"購買時間"),e("th",null,"Email"),e("th",{class:"backend-use"},"購買品項"),e("th",{class:"backend-use"},"應付金額"),e("th",null,"是否付款"),e("th",{class:"text-center"},"編輯")])],-1),Pe={class:"backend-use"},we={class:"list-unstyled"},xe={class:"col"},De={class:"col"},Le={class:"backend-use"},Ve={class:"form-check form-switch d-flex justify-content-center p-0"},Ee=["id","onUpdate:modelValue","onChange"],Se=["for"],Ue={key:0},Ae={key:1},Te={class:"d-flex justify-content-evenly"},Be=["onClick"],Ie=["onClick"],Ne={class:"row"},Re={class:"col"};function qe(o,t,g,c,s,a){const i=u("Loading"),P=u("Pagination"),w=u("OrderModal"),x=u("DelModal");return l(),n(b,null,[_(i,{active:s.isLoading,"onUpdate:active":t[0]||(t[0]=r=>s.isLoading=r),"can-cancel":!0,"is-full-page":s.fullPage},{default:U(()=>[ve]),_:1},8,["active","is-full-page"]),e("div",ye,[e("div",ke,[e("p",$e,[k("本頁有 "),e("span",null,d(s.orders.length),1),k(" 張訂單")]),e("table",Me,[Ce,e("tbody",null,[(l(!0),n(b,null,v(s.orders,r=>(l(),n("tr",{key:r.id},[e("td",null,d(o.$filters.date(r.create_at)),1),e("td",null,d(r.user.email),1),e("td",Pe,[e("ul",we,[(l(!0),n(b,null,v(r.products,(p,D)=>(l(),n("li",{key:D,class:"row mb-1"},[e("span",xe,d(p.product.title),1),e("span",De," 數量 : "+d(p.qty)+" "+d(p.product.unit),1)]))),128))])]),e("td",Le," $ "+d(o.$filters.currency(r.total)),1),e("td",null,[e("div",Ve,[M(e("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${r.id}`,"onUpdate:modelValue":p=>r.is_paid=p,onChange:()=>a.updatePaid(r)},null,40,Ee),[[C,r.is_paid]]),e("label",{class:"form-check-label",for:`paidSwitch${r.id}`},[r.is_paid?(l(),n("span",Ue,"已付款")):(l(),n("span",Ae,"未付款"))],8,Se)])]),e("td",null,[e("div",Te,[e("button",{type:"button",class:"btn btn-outline-main btn-sm",onClick:()=>a.openOrder("edit",r)},"檢視",8,Be),e("button",{type:"button",class:"btn btn-outline-accent btn-sm",onClick:()=>a.openOrder("delete",r),style:{padding:"0.25rem 0.5rem"}},"刪除",8,Ie)])])]))),128))])]),e("div",Ne,[e("div",Re,[_(P,{pages:s.pagination,onChangePage:a.getOrders},null,8,["pages","onChangePage"])]),_(w,{order:s.tempOrder,ref:"orderModal",onUpdateOrder:a.updateOrder,onCancelOrder:a.cancelOrder},null,8,["order","onUpdateOrder","onCancelOrder"]),_(x,{"temp-data":s.tempOrder,ref:"deleteModal",onDelData:a.deleteOrder},null,8,["temp-data","onDelData"])])])])],64)}const Ge=$(Oe,[["render",qe]]);export{Ge as default};
